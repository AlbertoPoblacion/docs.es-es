---
title: Programación en SQL Server y atributos de protección de host
ms.date: 03/30/2017
helpviewer_keywords:
- SQL Server [.NET Framework]
- permission sets, SQL Server
- SQL Server Programming and Host Protection Attributes
- managed code, SQL Server
- reliability [.NET Framework]
- writing reliable code
- hosts, reliability
- host protection attributes
- HostProtectionAttribute class, reliability
ms.assetid: 7dfa36b4-e773-4c75-a3ff-ff1af3ce4c4f
author: mairaw
ms.author: mairaw
ms.openlocfilehash: f1049187dabbea64599617bb4372ed50515a51e3
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/08/2019
ms.locfileid: "59088724"
---
# <a name="sql-server-programming-and-host-protection-attributes"></a>Programación en SQL Server y atributos de protección de host
La capacidad para cargar y ejecutar código administrado en un host de SQL Server requiere que se cumplan los requisitos del host tanto para la seguridad de acceso del código como para la protección de los recursos del host.  Los requisitos de seguridad de acceso de código se especifican mediante uno de los tres conjuntos de permisos de SQL Server: SAFE, EXTERNAL-ACCESS o UNSAFE. El código que se ejecuta dentro de los conjuntos de permisos SAFE o EXTERNAL-ACCESS debe evitar ciertos tipos o miembros que tienen aplicado el atributo <xref:System.Security.Permissions.HostProtectionAttribute>. <xref:System.Security.Permissions.HostProtectionAttribute> no es un permiso de seguridad, por más que una garantía de confiabilidad identifique construcciones de código específico (ya sean tipos o métodos) que el host podría rechazar.  El uso de <xref:System.Security.Permissions.HostProtectionAttribute> requiere un modelo de programación que ayude a proteger la estabilidad del host.  
  
## <a name="host-protection-attributes"></a>Atributos de protección del host  
 Los atributos de protección del host identifican los tipos o los miembros que no se ajustan al modelo de programación del host y representan los siguientes niveles crecientes de amenaza de confiabilidad:  
  
-   Son benignos.  
  
-   Podría provocar la desestabilización del código de usuario administrado por el servidor.  
  
-   Podría provocar la desestabilización del propio proceso del servidor.  
  
 SQL Server no permite el uso de un tipo o miembro que tiene un <xref:System.Security.Permissions.HostProtectionAttribute> que especifica un valor <xref:System.Security.Permissions.HostProtectionResource> de <xref:System.Security.Permissions.HostProtectionResource.SharedState>, <xref:System.Security.Permissions.HostProtectionResource.Synchronization>, <xref:System.Security.Permissions.HostProtectionResource.MayLeakOnAbort> o <xref:System.Security.Permissions.HostProtectionResource.ExternalProcessMgmt>. Esto impide que los ensamblados llamen a los miembros que habilitan el estado compartido, realizan una sincronización, podrían provocar una pérdida de recursos al finalizar o afectan a la integridad del proceso de SQL Server.  
  
### <a name="disallowed-types-and-members"></a>Tipos y miembros no permitidos  
 En la tabla siguiente se identifican los tipos y miembros cuyos valores <xref:System.Security.Permissions.HostProtectionResource> no están permitidos en SQL Server.  
  
|Espacio de nombres|Tipo o miembro|  
|---------------|--------------------|  
|`Microsoft.Win32`|<xref:Microsoft.Win32.PowerModeChangedEventArgs> clase<br /><br /> <xref:Microsoft.Win32.PowerModeChangedEventHandler> delegado<br /><br /> <xref:Microsoft.Win32.SessionEndedEventArgs> clase<br /><br /> <xref:Microsoft.Win32.SessionEndedEventHandler> delegado<br /><br /> <xref:Microsoft.Win32.SessionEndingEventArgs> clase<br /><br /> <xref:Microsoft.Win32.SessionEndingEventHandler> delegado<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventArgs> clase<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventHandler> delegado<br /><br /> <xref:Microsoft.Win32.SystemEvents> clase<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventArgs> clase<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventHandler> delegado<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangedEventArgs> clase<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangingEventArgs> clase|  
|`System.Collections`|<xref:System.Collections.ArrayList.Synchronized%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Collections.Hashtable.Synchronized%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Collections.Queue.Synchronized%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Collections.SortedList.Synchronized%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Collections.Stack.Synchronized%2A?displayProperty=nameWithType> método|  
|`System.ComponentModel`|<xref:System.ComponentModel.AddingNewEventArgs> clase<br /><br /> <xref:System.ComponentModel.AddingNewEventHandler> delegado<br /><br /> <xref:System.ComponentModel.ArrayConverter> clase<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventArgs> clase<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventHandler> delegado<br /><br /> <xref:System.ComponentModel.AsyncOperation> clase<br /><br /> <xref:System.ComponentModel.AsyncOperationManager> clase<br /><br /> <xref:System.ComponentModel.AttributeCollection> clase<br /><br /> <xref:System.ComponentModel.BackgroundWorker> clase<br /><br /> <xref:System.ComponentModel.BaseNumberConverter> clase<br /><br /> <xref:System.ComponentModel.BindingList%601> clase<br /><br /> <xref:System.ComponentModel.BooleanConverter> clase<br /><br /> <xref:System.ComponentModel.ByteConverter> clase<br /><br /> <xref:System.ComponentModel.CancelEventArgs> clase<br /><br /> <xref:System.ComponentModel.CancelEventHandler> delegado<br /><br /> <xref:System.ComponentModel.CharConverter> clase<br /><br /> <xref:System.ComponentModel.CollectionChangeEventArgs> clase<br /><br /> <xref:System.ComponentModel.CollectionChangeEventHandler> delegado<br /><br /> <xref:System.ComponentModel.CollectionConverter> clase<br /><br /> <xref:System.ComponentModel.ComponentCollection> clase<br /><br /> <xref:System.ComponentModel.ComponentConverter> clase<br /><br /> <xref:System.ComponentModel.ComponentEditor> clase<br /><br /> <xref:System.ComponentModel.ComponentResourceManager> clase<br /><br /> <xref:System.ComponentModel.Container> clase<br /><br /> <xref:System.ComponentModel.ContainerFilterService> clase<br /><br /> <xref:System.ComponentModel.CultureInfoConverter> clase<br /><br /> <xref:System.ComponentModel.CustomTypeDescriptor> clase<br /><br /> <xref:System.ComponentModel.DateTimeConverter> clase<br /><br /> <xref:System.ComponentModel.DecimalConverter> clase<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventArgs> clase<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.CheckoutException> clase<br /><br /> <xref:System.ComponentModel.Design.CommandID> clase<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventArgs> clase<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventArgs> clase<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.ComponentEventArgs> clase<br /><br /> <xref:System.ComponentModel.Design.ComponentEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventArgs> clase<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.DesignerCollection> clase<br /><br /> <xref:System.ComponentModel.Design.DesignerEventArgs> clase<br /><br /> <xref:System.ComponentModel.Design.DesignerEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.DesignerOptionService> clase<br /><br /> <xref:System.ComponentModel.Design.DesignerTransaction> clase<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventArgs> clase<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.DesignerVerb> clase<br /><br /> <xref:System.ComponentModel.Design.DesignerVerbCollection> clase<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContext> clase<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContextSerializer> clase<br /><br /> <xref:System.ComponentModel.Design.MenuCommand> clase<br /><br /> <xref:System.ComponentModel.Design.Serialization.ComponentSerializationService> clase<br /><br /> <xref:System.ComponentModel.Design.Serialization.ContextStack> clase<br /><br /> <xref:System.ComponentModel.Design.Serialization.DesignerLoader> clase<br /><br /> <xref:System.ComponentModel.Design.Serialization.InstanceDescriptor> clase<br /><br /> <xref:System.ComponentModel.Design.Serialization.MemberRelationshipService> clase<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventArgs> clase<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.Serialization.SerializationStore> clase<br /><br /> <xref:System.ComponentModel.Design.ServiceContainer> clase<br /><br /> <xref:System.ComponentModel.Design.ServiceCreatorCallback> delegado<br /><br /> <xref:System.ComponentModel.Design.StandardCommands> clase<br /><br /> <xref:System.ComponentModel.Design.StandardToolWindows> clase<br /><br /> <xref:System.ComponentModel.DoubleConverter> clase<br /><br /> <xref:System.ComponentModel.DoWorkEventArgs> clase<br /><br /> <xref:System.ComponentModel.DoWorkEventHandler> delegado<br /><br /> <xref:System.ComponentModel.EnumConverter> clase<br /><br /> <xref:System.ComponentModel.EventDescriptor> clase<br /><br /> <xref:System.ComponentModel.EventDescriptorCollection> clase<br /><br /> <xref:System.ComponentModel.EventHandlerList> clase<br /><br /> <xref:System.ComponentModel.ExpandableObjectConverter> clase<br /><br /> <xref:System.ComponentModel.HandledEventArgs> clase<br /><br /> <xref:System.ComponentModel.HandledEventHandler> delegado<br /><br /> <xref:System.ComponentModel.InstanceCreationEditor> clase<br /><br /> <xref:System.ComponentModel.Int16Converter> clase<br /><br /> <xref:System.ComponentModel.Int32Converter> clase<br /><br /> <xref:System.ComponentModel.Int64Converter> clase<br /><br /> <xref:System.ComponentModel.InvalidAsynchronousStateException> clase<br /><br /> <xref:System.ComponentModel.InvalidEnumArgumentException> clase<br /><br /> <xref:System.ComponentModel.ISynchronizeInvoke.BeginInvoke%2A> método<br /><br /> <xref:System.ComponentModel.License> clase<br /><br /> <xref:System.ComponentModel.LicenseContext> clase<br /><br /> <xref:System.ComponentModel.LicenseException> clase<br /><br /> <xref:System.ComponentModel.LicenseManager> clase<br /><br /> <xref:System.ComponentModel.LicenseProvider> clase<br /><br /> <xref:System.ComponentModel.LicFileLicenseProvider> clase<br /><br /> <xref:System.ComponentModel.ListChangedEventArgs> clase<br /><br /> <xref:System.ComponentModel.ListChangedEventHandler> delegado<br /><br /> <xref:System.ComponentModel.ListSortDescription> clase<br /><br /> <xref:System.ComponentModel.ListSortDescriptionCollection> clase<br /><br /> <xref:System.ComponentModel.MaskedTextProvider> clase<br /><br /> <xref:System.ComponentModel.MemberDescriptor> clase<br /><br /> <xref:System.ComponentModel.MultilineStringConverter> clase<br /><br /> <xref:System.ComponentModel.NestedContainer> clase<br /><br /> <xref:System.ComponentModel.NullableConverter> clase<br /><br /> <xref:System.ComponentModel.ProgressChangedEventArgs> clase<br /><br /> <xref:System.ComponentModel.ProgressChangedEventHandler> delegado<br /><br /> <xref:System.ComponentModel.PropertyChangedEventArgs> clase<br /><br /> <xref:System.ComponentModel.PropertyChangedEventHandler> delegado<br /><br /> <xref:System.ComponentModel.PropertyDescriptor> clase<br /><br /> <xref:System.ComponentModel.PropertyDescriptorCollection> clase<br /><br /> <xref:System.ComponentModel.ReferenceConverter> clase<br /><br /> <xref:System.ComponentModel.RefreshEventArgs> clase<br /><br /> <xref:System.ComponentModel.RefreshEventHandler> delegado<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventArgs> clase<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventHandler> delegado<br /><br /> <xref:System.ComponentModel.SByteConverter> clase<br /><br /> <xref:System.ComponentModel.SingleConverter> clase<br /><br /> <xref:System.ComponentModel.StringConverter> clase<br /><br /> <xref:System.ComponentModel.SyntaxCheck> clase<br /><br /> <xref:System.ComponentModel.TimeSpanConverter> clase<br /><br /> <xref:System.ComponentModel.TypeConverter> clase<br /><br /> <xref:System.ComponentModel.TypeDescriptionProvider> clase<br /><br /> <xref:System.ComponentModel.TypeDescriptor> clase<br /><br /> <xref:System.ComponentModel.TypeListConverter> clase<br /><br /> <xref:System.ComponentModel.UInt16Converter> clase<br /><br /> <xref:System.ComponentModel.UInt32Converter> clase<br /><br /> <xref:System.ComponentModel.UInt64Converter> clase<br /><br /> <xref:System.ComponentModel.WarningException> clase<br /><br /> <xref:System.ComponentModel.Win32Exception> clase|  
|`System.Diagnostics`|<xref:System.Diagnostics.Debug.Listeners%2A?displayProperty=nameWithType> propiedad<br /><br /> <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=nameWithType> propiedad<br /><br /> <xref:System.Diagnostics.EventLog.SynchronizingObject%2A?displayProperty=nameWithType> propiedad<br /><br /> <xref:System.Diagnostics.ConsoleTraceListener> clase<br /><br /> <xref:System.Diagnostics.DefaultTraceListener> clase<br /><br /> <xref:System.Diagnostics.DelimitedListTraceListener> clase<br /><br /> <xref:System.Diagnostics.EventLogTraceListener> clase<br /><br /> <xref:System.Diagnostics.PerformanceCounter> clase<br /><br /> <xref:System.Diagnostics.PerformanceCounterCategory> clase<br /><br /> <xref:System.Diagnostics.Process> clase<br /><br /> <xref:System.Diagnostics.ProcessStartInfo> clase<br /><br /> <xref:System.Diagnostics.TextWriterTraceListener> clase<br /><br /> <xref:System.Diagnostics.TraceListener> clase<br /><br /> <xref:System.Diagnostics.XmlWriterTraceListener> clase<br /><br /> <xref:System.Diagnostics.TraceSource.Listeners%2A?displayProperty=nameWithType> propiedad|  
|`System.IO`|<xref:System.IO.Stream.Synchronized%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.IO.TextReader.Synchronized%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.IO.TextWriter.Synchronized%2A?displayProperty=nameWithType> método|  
|`System.Reflection.Emit`|<xref:System.Reflection.Emit.ConstructorBuilder> clase<br /><br /> <xref:System.Reflection.Emit.EventBuilder> clase<br /><br /> <xref:System.Reflection.Emit.FieldBuilder> clase<br /><br /> <xref:System.Reflection.Emit.MethodBuilder> clase<br /><br /> <xref:System.Reflection.Emit.CustomAttributeBuilder> clase<br /><br /> <xref:System.Reflection.Emit.MethodRental> clase<br /><br /> <xref:System.Reflection.Emit.ModuleBuilder> clase<br /><br /> <xref:System.Reflection.Emit.PropertyBuilder> clase<br /><br /> <xref:System.Reflection.Emit.TypeBuilder> clase<br /><br /> <xref:System.Reflection.Emit.UnmanagedMarshal> clase|  
|`System.Text`|<xref:System.Text.RegularExpressions.Group.Synchronized%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Text.RegularExpressions.Match.Synchronized%2A?displayProperty=nameWithType> método|  
|`System.Threading`|<xref:System.Threading.AutoResetEvent> clase<br /><br /> <xref:System.Threading.EventWaitHandle> clase<br /><br /> <xref:System.Threading.ManualResetEvent> clase<br /><br /> <xref:System.Threading.Monitor> clase<br /><br /> <xref:System.Threading.Mutex> clase<br /><br /> <xref:System.Threading.ReaderWriterLock> clase<br /><br /> <xref:System.Threading.Semaphore> clase<br /><br /> <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Threading.Thread.BeginCriticalRegion%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Threading.Thread.EndCriticalRegion%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Threading.Thread.FreeNamedDataSlot%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Threading.Thread.GetData%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Threading.Thread.SetApartmentState%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Threading.Thread.SetData%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Threading.Thread.SpinWait%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Threading.Thread.TrySetApartmentState%2A?displayProperty=nameWithType> método<br /><br /> <xref:System.Threading.ThreadPool> clase<br /><br /> <xref:System.Threading.Timer> clase|  
|`System.Timers`|<xref:System.Timers.Timer> clase|  
|`System.Web.Configuration`|<xref:System.Web.Configuration.MachineKeyValidationConverter> clase|  
|`System.Windows.Forms`|<xref:System.Windows.Forms.AutoCompleteStringCollection.SyncRoot%2A?displayProperty=nameWithType> propiedad|  
  
## <a name="sql-server-permission-sets"></a>Conjuntos de permisos de SQL Server  
 SQL Server permite a los usuarios especificar los requisitos de confiabilidad del código implementado en una base de datos. Cuando se cargan los ensamblados en la base de datos, el autor del ensamblado puede especificar uno de los tres conjuntos de permisos para dicho ensamblado: SAFE, EXTERNAL-ACCESS o UNSAFE.  
  
|Conjunto de permisos|SAFE|EXTERNAL-ACCESS|UNSAFE|  
|--------------------|----------|----------------------|------------|  
|Seguridad de acceso del código|Solo ejecución|Ejecución + acceso a recursos externos|Sin restricción|  
|Restricciones del modelo de programación|Sí|Sí|Sin restricciones|  
|Requisito de verificabilidad|Sí|Sí|No|  
|Capacidad para llamar a código nativo|No|No|Sí|  
  
 SAFE es el modo más confiable y seguro y cuenta con restricciones asociadas relativas al modelo de programación permitido. El código SAFE dispone de características de seguridad y de gran confiabilidad. Los ensamblados SAFE tienen permisos suficientes para ejecutarse, efectuar cálculos y obtener acceso a la base de datos local. Los ensamblados SAFE deben ser de un tipo comprobable y no pueden llamar al código no administrado.  
  
 EXTERNAL-ACCESS proporciona una opción de seguridad intermedia y permite que el código obtenga acceso a los recursos externos a la base de datos, pero manteniendo la confiabilidad y la seguridad de SAFE.  
  
 UNSAFE está pensado para el código de plena confianza que solo pueden crear los administradores de base de datos. Este código de confianza no tiene ninguna restricción de acceso y puede llamar a un código no administrado (nativo).  
  
 SQL Server usa la capa de directiva de seguridad de acceso del código del nivel de host para configurar una directiva de host que conceda uno de los tres conjuntos de permisos según el conjunto de permisos almacenado en los catálogos de SQL Server. El código administrado que se ejecuta dentro de la base de datos siempre obtiene uno de estos conjuntos de permisos de acceso del código.  
  
## <a name="programming-model-restrictions"></a>Restricciones del modelo de programación  
 El modelo de programación del código administrado de SQL Server requiere funciones, procedimientos y tipos que no requieren el uso del estado mantenido en varias invocaciones ni del estado compartido en varias sesiones de usuario. Además, como se ha descrito anteriormente, la presencia de un estado compartido puede generar excepciones críticas que afecten a la escalabilidad y a la confiabilidad de la aplicación.  
  
 Dadas estas consideraciones, SQL Server no permite el uso de variables estáticas ni de miembros de datos estáticos. En cuanto a los ensamblados SAFE y EXTERNAL-ACCESS, SQL Server examina los metadatos del ensamblado al crear el ensamblado (CREATE ASSEMBLY). Se produce un error al crear dichos ensamblados si encuentra el uso de variables y miembros de datos estáticos.  
  
## <a name="see-also"></a>Vea también

- <xref:System.Security.Permissions.HostProtectionAttribute>
- <xref:System.Security.Permissions.HostProtectionResource>
